---
import { countWords } from "alfaaz";
import matter from "gray-matter";
import { readFile } from "node:fs/promises";
import { basename } from "node:path";
import slugify from "slugify";
import BlogPost from "../../layouts/BlogPost.astro";

export async function getStaticPaths() {
	const glob = (await Astro.glob("../../posts/*.{md,mdx}")).map(async (p) => {
		const post = await readFile(p.file);

		const { content } = matter(post);

		return {
			params: {
				slug: slugify(basename(p.file, ".md")),
			},
			props: {
				post: {
					...p,
					frontmatter: {
						...p.frontmatter,
						length: countWords(content),
					}
				},
			},
		};
	});

	return await Promise.all(glob);
}

const { frontmatter, Content } = Astro.props.post;
---

<BlogPost {...frontmatter}>
	<Content />
</BlogPost>
